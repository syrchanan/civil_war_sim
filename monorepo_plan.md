# Monorepo Plan for Civil War Sim Tabletop Tools

## Repository Layout

This repo will be structured as a true monorepo, supporting both the original Python codebase and a parallel TypeScript port for browser-based use. Both implementations will share a unified test case format to maximize reliability and reduce duplicate work.

### Directory Structure

```
/
├── python/             # All Python code and modules
├── typescript/         # All TypeScript code and modules (importable as package)
├── test_cases/         # Shared golden test case files (JSON, language-agnostic)
│   ├── case1.json
│   ├── ...
├── README.md
├── monorepo_plan.md    # This plan document
```

## Development Workflow

### 1. Python Branch is Main Source of Truth (for now)
- **Develop features and simulation improvements in `/python`.**
- When a stable milestone or feature is reached, generate/update corresponding golden file(s) in `/test_cases`.
- Commit with a message noting, e.g., "Ready for TypeScript port: [feature/commit description]".
- Open a GitHub issue/PR to track the need for ports.

### 2. TypeScript Implementation Mirrors Python
- In `/typescript`, port logic and structures to match `/python`'s latest model.
- Structure TS code as a pure logic package (no UI, just functions/classes).
- Ensure input/output types match the JSON case format—this guarantees testability and smooth future integration in a React app.
- Optionally, publish `/typescript` as an npm package or link as a workspace dependency for your front-end repo.

## Unified Testing Strategy: Golden Files

### Golden File Approach
- All test cases will be defined in easy-to-read JSON files under `/test_cases`.
- Each file contains a complete set of inputs and expected outputs for a simulation scenario.
- Both `/python/tests` and `/typescript/tests` will implement test runners that:
    1. Parse each golden file.
    2. Feed the inputs into the respective implementation.
    3. Assert that outputs match the golden file’s expected results.
    4. (If randomness is present, use fixed seeds for determinism whenever possible.)

### Example Test Case Format
```json
{
  "description": "10v10 basic test, identical units",
  "inputs": {
    "unit_1": { "count": 10, "attack": 5, "defense": 2 },
    "unit_2": { "count": 10, "attack": 4, "defense": 2 }
  },
  "expected": {
    "winner": "unit_1",
    "remaining": { "unit_1": 3, "unit_2": 0 }
  }
}
```

## Tips & Tricks for Success

- **Test Early, Test Often:** As soon as a new feature or edge case is handled, add a golden test case—even if it breaks the TS implementation, it serves as a clear target.
- **Keep Pure Logic in `/typescript`:** Avoid UI, DOM, or React dependencies in your logic package. This makes it far easier to test and import from any front-end.
- **Automation:** Small scripts that check for output parity between `/python` and `/typescript` across all cases (and notify on mismatches) are invaluable.
- **Randomness:** Use a fixed seed if possible for random number generators in both implementations, to keep tests deterministic.
- **Descriptive Test Cases:** Include a `description` field in your JSON for clear error messages and easy tracking.
- **Documentation:** Use your README to track gaps between implementations and feature parity.

## Future Ideas
- **CI Integration:** Set up GitHub Actions or similar to run both sets of tests on every push. Alert if golden case output diverges.
- **Automate Case Generation:** If one side is the "reference" (typically Python), write scripts to export expected results in bulk.
- **Type Checking Against JSON:** Use schema validation to ensure JSON case files are always compatible with both implementations.
- **Shared Utilities:** For instance, a random-seed manager implemented in both Python and TS for consistent simulation state.

---

With this plan, you can iterate in Python, port to TypeScript at checkpoints, and ensure correctness and reliability via shared golden files. This also lays groundwork for expansion: ultimately, any simulation logic can be re-used or transplanted to other games or platforms with minimal hassle.

---

*Monorepo plan generated by Goose, 2025-12-31*
